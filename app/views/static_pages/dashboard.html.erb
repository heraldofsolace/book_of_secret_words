<% inbox_messages  = @messages %>
<% pinned_messages = @messages.pinned %>
<% public_messages = @messages.public_messages %>

<div data-controller="dashboard-tabs" class="grid gap-10 lg:grid-cols-[220px_minmax(0,1fr)]">

  <!-- Sidebar -->
  <aside class="space-y-6">
    <div>
      <p class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-2">
        Dashboard
      </p>
      <h1 class="text-xl font-semibold bg-gradient-to-r from-rose-400 to-red-400 bg-clip-text text-transparent">
        Hi, <%= @user.username %> ðŸ‘‹
      </h1>
    </div>

    <nav class="space-y-1 text-sm">
      <a href="#"
         data-dashboard-tabs-target="tab"
         data-dashboard-tab-target="inbox"
         data-action="click->dashboard-tabs#select"
         class="flex items-center justify-between rounded-xl px-3 py-2 transition-all duration-200 ease-out transform">
        <span>Inbox</span>
        <span class="text-[11px] text-slate-400">
          <%= inbox_messages.size %>
        </span>
      </a>

      <a href="#"
         data-dashboard-tabs-target="tab"
         data-dashboard-tab-target="pinned"
         data-action="click->dashboard-tabs#select"
         class="flex items-center justify-between rounded-xl px-3 py-2 transition-all duration-200 ease-out transform">
        <span>Pinned</span>
        <span class="text-[11px] text-slate-400">
          <%= pinned_messages.size %>
        </span>
      </a>

      <a href="#"
         data-dashboard-tabs-target="tab"
         data-dashboard-tab-target="public"
         data-action="click->dashboard-tabs#select"
         class="flex items-center justify-between rounded-xl px-3 py-2 transition-all duration-200 ease-out transform">
        <span>Public</span>
        <span class="text-[11px] text-slate-400">
          <%= public_messages.size %>
        </span>
      </a>
    </nav>
  </aside>

  <!-- Main -->
  <section class="space-y-10">

    <!-- Share link -->
    <!-- Share link -->
    <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-5 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div class="space-y-2">
        <h2 class="text-sm font-semibold text-slate-50">
          Share your secret page
        </h2>
        <p class="text-xs text-slate-400">
          Copy your links and share them anywhere to start receiving anonymous messages or show off your public board.
        </p>
      </div>

      <% secret_link  = new_user_message_url(@user.username) %>
      <% profile_link = public_profile_url(@user.username) %> <%# TODO: replace with your actual public profile route helper if different %>

      <div class="flex w-full max-w-md flex-col gap-3">
        <!-- Secret page link -->
        <div class="space-y-1">
          <p class="text-[11px] font-medium uppercase tracking-wide text-slate-400">
            Secret page link
          </p>
          <div class="flex items-center gap-2">
            <input
              type="text"
              readonly
              value="<%= secret_link %>"
              class="w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-xs text-slate-200 truncate focus:outline-none" />
            <button
              type="button"
              onclick="navigator.clipboard.writeText('<%= secret_link %>')"
              data-controller="magnetic"
              data-magnetic-target="inner"
              data-action="mousemove->magnetic#mousemove mouseleave->magnetic#mouseleave"
              class="relative inline-flex"
            >
  <span class="inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-red-500 to-rose-500 px-3 py-2 text-xs font-semibold text-white shadow-red-500/30 shadow-lg transition-transform duration-150 ease-out will-change-transform">
    Copy
  </span>
            </button>
          </div>
        </div>

        <!-- Public profile link -->
        <div class="space-y-1">
          <p class="text-[11px] font-medium uppercase tracking-wide text-slate-400">
            Public profile link
          </p>
          <div class="flex items-center gap-2">
            <input
              type="text"
              readonly
              value="<%= profile_link %>"
              class="w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-xs text-slate-200 truncate focus:outline-none" />
            <button
              type="button"
              onclick="navigator.clipboard.writeText('<%= profile_link %>')"
              data-controller="magnetic"
              data-magnetic-target="inner"
              data-action="mousemove->magnetic#mousemove mouseleave->magnetic#mouseleave"
              class="relative inline-flex"
            >
  <span class="inline-flex items-center justify-center rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-xs font-semibold text-slate-100 hover:bg-slate-700 transition-transform duration-150 ease-out will-change-transform">
    Copy
  </span>
            </button>
          </div>
        </div>
      </div>
    </div>


    <!-- Inbox tab panel -->
    <div data-dashboard-tabs-target="panel" data-dashboard-tab-panel="inbox" class="space-y-4">
      <div class="flex items-center justify-between gap-2">
        <div>
          <h2 class="text-lg font-semibold text-slate-50">Inbox</h2>
          <p class="text-xs text-slate-400 mt-1">
            Latest anonymous messages sent to your page.
          </p>
        </div>
      </div>

      <% if inbox_messages.any? %>
        <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
          <% inbox_messages.each do |message| %>
            <article class="flex flex-col rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-md shadow-black/20 hover:shadow-red-500/10 transition">
              <header class="mb-2 flex items-center justify-between text-[11px] text-slate-500">
                <span>Anonymous</span>
              </header>

              <p class="text-sm text-slate-100 leading-relaxed flex-1">
                <%= simple_format(message.body) %>
              </p>

              <!-- Actions -->
              <footer class="mt-4 flex items-center justify-between text-[11px] text-slate-400">
                <span class="italic">
                  Received <%= l(message.created_at, format: :short) rescue message.created_at.to_s(:short) %>
                </span>
                <div class="flex items-center gap-2">
                  <% if message.pinned? %>
                    <%= link_to "Unpin",
                                message_path(message, message: { pinned: false }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-rose-300 transition" %>
                  <% else %>
                    <%= link_to "Pin",
                                message_path(message, message: { pinned: true }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-rose-300 transition" %>
                  <% end %>
                  <span class="text-slate-600">â€¢</span>
                  <% if message.public? %>
                    <%= link_to "Make private",
                                message_path(message, message: { public: false }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-slate-200 transition" %>
                  <% else %>
                    <%= link_to "Make public",
                                message_path(message, message: { public: true }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-slate-200 transition" %>
                  <% end %>
                  <span class="text-slate-600">â€¢</span>
                  <%= link_to "Delete",
                              message_path(message),
                              data: { turbo_method: :delete, confirm: "Delete this message?" },
                              class: "underline-offset-2 hover:underline hover:text-red-300 transition" %>
                </div>
              </footer>
            </article>
          <% end %>
        </div>

        <div class="pt-4">
          <%= paginate inbox_messages if respond_to?(:paginate) %>
        </div>
      <% else %>
        <div class="rounded-2xl border border-dashed border-slate-700 bg-slate-900/40 p-10 text-center">
          <p class="text-sm text-slate-300">
            No messages yet.
          </p>
          <p class="mt-2 text-xs text-slate-500">
            Share your secret link to start receiving anonymous messages.
          </p>
        </div>
      <% end %>
    </div>

    <!-- Pinned tab panel -->
    <div data-dashboard-tabs-target="panel" data-dashboard-tab-panel="pinned" class="space-y-4 hidden">
      <div class="flex items-center justify-between gap-2">
        <div>
          <h2 class="text-lg font-semibold text-slate-50">Pinned messages</h2>
          <p class="text-xs text-slate-400 mt-1">
            Messages youâ€™ve pinned to keep handy.
          </p>
        </div>
      </div>

      <% if pinned_messages.any? %>
        <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
          <% pinned_messages.each do |message| %>
            <article class="flex flex-col rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-md shadow-black/20 hover:shadow-red-500/10 transition">
              <header class="mb-2 flex items-center justify-between text-[11px] text-slate-500">
                <span>Anonymous</span>
                <span class="rounded-full bg-rose-500/10 px-2 py-0.5 text-[10px] text-rose-300">
                  Pinned
                </span>
              </header>

              <p class="text-sm text-slate-100 leading-relaxed flex-1">
                <%= simple_format(message.body) %>
              </p>

              <footer class="mt-4 flex items-center justify-between text-[11px] text-slate-400">
                <span class="italic">
                  Received <%= l(message.created_at, format: :short) rescue message.created_at.to_s(:short) %>
                </span>
                <div class="flex items-center gap-2">
                  <%= link_to "Unpin",
                              message_path(message, message: { pinned: false }),
                              data: { turbo_method: :patch },
                              class: "underline-offset-2 hover:underline hover:text-rose-300 transition" %>
                  <span class="text-slate-600">â€¢</span>
                  <% if message.public? %>
                    <%= link_to "Make private",
                                message_path(message, message: { public: false }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-slate-200 transition" %>
                  <% else %>
                    <%= link_to "Make public",
                                message_path(message, message: { public: true }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-slate-200 transition" %>
                  <% end %>
                  <span class="text-slate-600">â€¢</span>
                  <%= link_to "Delete",
                              message_path(message),
                              data: { turbo_method: :delete, confirm: "Delete this message?" },
                              class: "underline-offset-2 hover:underline hover:text-red-300 transition" %>
                </div>
              </footer>
            </article>
          <% end %>
        </div>
      <% else %>
        <div class="rounded-2xl border border-dashed border-slate-700 bg-slate-900/40 p-10 text-center">
          <p class="text-sm text-slate-300">
            You havenâ€™t pinned any messages yet.
          </p>
          <p class="mt-2 text-xs text-slate-500">
            Pin your favorite messages from the inbox tab.
          </p>
        </div>
      <% end %>
    </div>

    <!-- Public tab panel -->
    <div data-dashboard-tabs-target="panel" data-dashboard-tab-panel="public" class="space-y-4 hidden">
      <div class="flex items-center justify-between gap-2">
        <div>
          <h2 class="text-lg font-semibold text-slate-50">Public messages</h2>
          <p class="text-xs text-slate-400 mt-1">
            Messages that are visible on your public page.
          </p>
        </div>
      </div>

      <% if public_messages.any? %>
        <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
          <% public_messages.each do |message| %>
            <article class="flex flex-col rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-md shadow-black/20 hover:shadow-red-500/10 transition">
              <header class="mb-2 flex items-center justify-between text-[11px] text-slate-500">
                <span>Anonymous</span>
                <span class="rounded-full bg-red-500/10 px-2 py-0.5 text-[10px] text-red-300">
                  Public
                </span>
              </header>

              <p class="text-sm text-slate-100 leading-relaxed flex-1">
                <%= simple_format(message.body) %>
              </p>

              <footer class="mt-4 flex items-center justify-between text-[11px] text-slate-400">
                <span class="italic">
                  Received <%= l(message.created_at, format: :short) rescue message.created_at.to_s(:short) %>
                </span>
                <div class="flex items-center gap-2">
                  <% if message.pinned? %>
                    <%= link_to "Unpin",
                                message_path(message, message: { pinned: false }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-rose-300 transition" %>
                  <% else %>
                    <%= link_to "Pin",
                                message_path(message, message: { pinned: true }),
                                data: { turbo_method: :patch },
                                class: "underline-offset-2 hover:underline hover:text-rose-300 transition" %>
                  <% end %>
                  <span class="text-slate-600">â€¢</span>
                  <%= link_to "Make private",
                              message_path(message, message: { public: false }),
                              data: { turbo_method: :patch },
                              class: "underline-offset-2 hover:underline hover:text-slate-200 transition" %>
                  <span class="text-slate-600">â€¢</span>
                  <%= link_to "Delete",
                              message_path(message),
                              data: { turbo_method: :delete, confirm: "Delete this message?" },
                              class: "underline-offset-2 hover:underline hover:text-red-300 transition" %>
                </div>
              </footer>
            </article>
          <% end %>
        </div>
      <% else %>
        <div class="rounded-2xl border border-dashed border-slate-700 bg-slate-900/40 p-10 text-center">
          <p class="text-sm text-slate-300">
            No public messages yet.
          </p>
          <p class="mt-2 text-xs text-slate-500">
            Mark messages as public to show them on your page.
          </p>
        </div>
      <% end %>
    </div>

  </section>

</div>
